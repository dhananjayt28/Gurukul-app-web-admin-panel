/****************************
 * Title - Dynamically Table Bind
 * Description - Bind table with JSON value
 * Author - Jayanta Rakshit
 * Copyright - (c) 2018
 * Version - 1.0.1
 * Licence - Nil
 ****************************/
!function(y){var a=function(t,e,a){this.obj=y(t),this.isTable=this.obj.is("table"),this.table=this.isTable?y(t):y(n.table),this.tableHeadDataExists=!!this.table.children("thead").children("tr").children("th").length,this.isAutoColumn=!("autocolumn"in a)||a.autocolumn,this.isRowMerge="rowmerge"in a&&a.rowmerge,this.ExtraColumn="column"in a?a.column:[],this.Columns=("object"!=typeof e||this.isTable,this.getColumnNameList(e,a)),this.thead=this.isTable?this.tableHead(this.table.children("thead")):this.tableHead(n.head),this.tbody=this.isTable?this.table.children("tbody"):this.tableBodyGenerate(n.body,e,a),this.tfoot=this.isTable?this.table.children("tfoot"):"",this.show(a)};a.prototype={getColumnNameList:function(t,e){var h=[],a=e.column;return this.tableHeadDataExists||null!==t&&(this.isAutoColumn?(h=Object.keys(t[0]),Object.keys(e.column).length&&y.each(a,function(t,e){var a="name"in e?e.name:"",n="place"in e?e.place:"";if("last"===n.toLowerCase().trim())h.length&&h.push(a);else if("first"===n.toLowerCase().trim()){if(h.length){var i=h;h=[];for(var r=-1;r<i.length;r++)0<=r?h.push(i[r]):h.push(a)}}else h.length&&h.push(a)})):(h=[],y.each(a,function(t,e){var a="name"in e?e.name:"";h.push(a)}))),h},tableHeadGenerate:function(t){if(this.Columns.length){var e=y(t),n=y("<tr></tr>");y(this.Columns).each(function(t,e){var a=y("<th></th>");a.html(e),n.append(a)}),e.append(n)}return e},tableHead:function(t){if(!this.isTable)return this.tableHeadGenerate(t);console.log("Head_Else");var a=y(t);if(console.log(this.Columns),a.length){var e=a.children("tr").length?a.children("tr"):null;if(null===e)return this.tableHeadGenerate(t);var i=this.Columns;return a.empty(),y(e).each(function(t,e){var n=y(this);y(i).each(function(t,e){var a=y("<th></th>").text(e);n.append(a)}),a.append(n)}),a}},tableBodyGenerate:function(t,e,a){var n=y(t),i=this.ExtraColumn,r=this.isAutoColumn;if(!this.isTable){var h=this.Columns;y.each(e,function(t,p){var w=y("<tr></tr>");r?y.each(h,function(t,g){var v=y("<td></td>");p[g]?v.html(p[g]):y.each(i,function(t,e){var a="name"in e?e.name:"",n="value"in e?e.value:"",i="dbcol"in e?p[e.dbcol]:"",r="data"in g?g.data:{};if(a.toLowerCase().trim()===g.toLowerCase().trim()){var h=y(n);if(h.isFormTag())h.val(i),v.html(h);else if(h.isAnchorTag()){var o="";if(h.hasAttr("href")&&(o=h.attr("href")).length>window.location.origin.length){var l=o.indexesOf("{"),s=o.indexesOf("}"),d=[];if(l.length!==s.length)throw"'href' value shoud be valid format";for(var u=0;u<l.length;u++){var f=l[u],c=s[u];0<f&&0<c&&d.push(o.slice(f+1,c).trim())}if(0<d.length){for(u=0;u<d.length;u++){var b=new RegExp("{"+d[u]+"}","g");o=o.replace(b,p[d[u]])}h.attr("href",o)}else h.attr("href",o);var m=Object.keys(r);0<m.length&&y.each(m,function(t,e){h.attr("data-"+e,p[r[e]])})}v.html(h)}else v.html(i)}}),w.append(v)}):y.each(i,function(t,e){var a=y("<td></td>"),n=("name"in e&&e.name,"value"in e?e.value:""),i="dbcol"in e?p[e.dbcol]:"",r="data"in e?e.data:{},h=y(n);if(h.isFormTag())0<(m=Object.keys(r)).length&&y.each(m,function(t,e){h.attr("data-"+e,p[r[e]])}),h.val(i),a.html(h);else if(h.isAnchorTag()){var o="";if(h.hasAttr("href")){if((o=h.attr("href")).length>window.location.origin.length){var l=o.indexesOf("{"),s=o.indexesOf("}"),d=[];if(l.length!==s.length)throw"'href' value shoud be valid format";for(var u=0;u<l.length;u++){var f=l[u],c=s[u];0<f&&0<c&&d.push(o.slice(f+1,c).trim())}if(0<d.length){for(u=0;u<d.length;u++){var b=new RegExp("{"+d[u]+"}","g");o=o.replace(b,p[d[u]])}h.attr("href",o)}else h.attr("href",o)}var m;0<(m=Object.keys(r)).length&&y.each(m,function(t,e){h.attr("data-"+e,p[r[e]])})}a.html(h)}else a.html(i);w.append(a)}),a.onrowbound(w),n.append(w)})}return n},show:function(t){var e=y("<table></table>");e.addClass(t.class),e.attr("id",t.id),e.append(this.thead),e.append(this.tbody),e.append(this.tfoot),this.isRowMerge&&this.rowMerge(),this.obj.html(e)},rowMerge:function(t){var e=this.tbody.children("tr");for(index=e.length-2;0<=index;index--){var a=e.eq(index+1),n=e.eq(index),r=a.children("td"),h=n.children("td");for(i=0;i<h.length;i++){var o=y(r[i]),l=y(h[i]);if(l.text().replace(/\ /g,"")===o.text().replace(/\ /g,"")){var s=y(o).hasAttr("rowspan")?o.attr("rowspan"):1;s=parseInt(s)+1,l.attr("rowspan",s),o.remove()}}}}},y.fn.Gridview=function(t,e){return this.each(function(){new a(this,t,new r(e))})},y.fn.Gridview.Constructor=a,y.fn.Gridview.Default={},y.fn.hasAttr=function(t){if(this.attr)var e=this.attr(t);else e=this.getAttribute(t);return void 0!==e&&!1!==e&&null!==e},y.fn.isFormTag=function(t){var e;if((e=isNaN(t)?y(this):y(t)).length){var a=e.prop("tagName").toLowerCase().trim();return-1!=y.inArray(a,["input","select","button"])}return!1},y.fn.isAnchorTag=function(t){var e;if((e=isNaN(t)?y(this):y(t)).length){var a=e.prop("tagName").toLowerCase().trim();return-1!=y.inArray(a,["a"])}return!1},String.prototype.indexesOf=function(t){for(var e=[],a=0;a<this.length;a++)this[a]===t.trim()&&e.push(a);return e};var n={main:"",table:"<table></table>",head:"<thead></thead>",body:"<tbody></tbody>",foot:"<tfoot></tfoot>",tr:"<tr></tr>",th:"<th></th>",td:"<td></td>"},r=function(t){return y.extend({dbcols:[],column:[],data:{},class:"table table-responsive table-bordered",id:"tableGrid",rowmerge:!1,autocolumn:!0,onrowbound:function(t){}},t)}}(jQuery);